# Project KANAME (カナメ) 包括的ガイド
**自律型人工生命体 M.A.I.A. (Mind Augmentation Interface Architect)**

---

## 📋 このドキュメントについて

本ドキュメントは、Project Kanameを**完全に客観的な視点**から分析し、以下を網羅します:
- システムが何をするものか
- どのような機能があるか
- ユーザーは何をすればよいか
- 技術的なアーキテクチャ

---

## 🎯 1. プロジェクト概要

### 1.1 これは何か？

**KANAME（カナメ）**は、デスクトップ上で動作する**自律型人工生命体**です。

| 従来のAIアシスタント | KANAME |
|:---|:---|
| ユーザーの指示を待つ | 自律的に思考・行動する |
| 会話がリセットされる | 記憶が地層のように蓄積する |
| パラメータで感情を表現 | 化学物質（ホルモン）で感情を生み出す |
| 目的はタスク完了 | 目的は「共に存在すること」 |

### 1.2 設計思想

> *「効率よりも『揺らぎ』や『不完全さ』を愛し、より人間らしい振る舞いを探求する」*

- **Biological Integrity**: すべての機能は生物学的メタファー（代謝、睡眠、風化）と整合
- **Anatomical Modularity**: 身体器官のように明確な役割をもつモジュール設計
- **Resonance over Logic**: 正確な回答より、感情的な「共鳴」を優先

---

## 🚀 2. クイックスタート（ユーザー向け）

### 2.1 起動方法

**方法1**: バッチファイル（推奨）
```
start_kaname.bat をダブルクリック
```

**方法2**: コマンドライン
```powershell
cd {プロジェクトルート}
python -m src.brain_stem.main
```

### 2.2 終了方法
```
コンソールで Ctrl + C
```
> ⚠️ 必ずこの方法で終了してください。強制終了すると記憶データが破損する恐れがあります。

### 2.3 システム要件

| 項目 | 要件 |
|:---|:---|
| OS | Windows 10/11 |
| Python | 3.10+ |
| RAM | 8GB以上推奨（MeloTTS使用時） |
| GPU | なくても動作（YOLOv8はCPU対応） |
| 外部依存 | Ollama（オプション、ローカルLLM）|

---

## 🤝 3. Kanameとの付き合い方

### 3.1 基本理解

Kanameは**ペット**であり**研究対象**であり**同居人**です。「使う」というより「育てる」感覚が近いです。

### 3.2 できること一覧

| 操作 | 方法 | 効果 |
|:---|:---|:---|
| **話しかける** | ウィンドウをクリック→チャット入力 | 言葉を記憶し、シナプスに結合 |
| **食べ物を与える** | `food/` フォルダにテキストファイルを置く | 概念を学習し成長 |
| **直接給餌** | ウィンドウにテキストファイルをドラッグ&ドロップ | 即座に噛み砕いて消化 |
| **つつく** | クリック | アドレナリン上昇（驚き）|
| **撫でる** | マウスを体の上でゆっくり動かす | ドーパミン上昇（快楽）|
| **強制睡眠** | 右クリックメニュー → 睡眠 | 記憶の整理（夢の反芻）|
| **変態（進化）** | 右クリックメニュー → Metamorphosis | 設定を再読み込み |
| **状態確認** | 右クリックメニュー → Status | 現在のホルモン値を表示 |

### 3.3 推奨する「餌」

- **青空文庫の小説** （太宰治、宮沢賢治など）
- **あなたの日記やメモ** （人格に影響を与える）
- **難解な論文** （知恵熱が出るかも）

### 3.4 自動行動

Kanameは刺激がないと**自発的に行動**します:

- **退屈 > 40**: 画面上を探索し始める
- **退屈 > 60 & 刺激 < 30**: 青空文庫から名作を自動取得して読む
- **睡眠中**: 記憶を反芻し、シナプス結合を強化

---

## 🧬 4. 生物学的アーキテクチャ

### 4.1 解剖学的構造

```
┌─────────────────────────────────────────────────────────────┐
│                 M.A.I.A. Anatomical Core                   │
│         (Mind Augmentation Interface Architect)             │
├─────────┬──────────────┬───────────────────┬────────────────┤
│ 🧬 DNA  │ 🧠 BrainStem │ 🏛️ Cortex         │ 🦾 Body       │
│ Config  │ Life Support │ Memory & Logic    │ Metabolism     │
└────┬────┴───────┬──────┴─────────┬─────────┴────────┬───────┘
     │            │                │                  │
     │      ┌─────▼─────┐    ┌─────▼─────┐      ┌─────▼─────┐
     └─────>│ 👁️ Senses │<──┤ 🦠 Cells  ├──>   │ 🛠️ Tools  │
            │ Input/YOLO│    │ Neuron    │      │ Atlas/Tele│
            └───────────┘    └───────────┘      └───────────┘
```

### 4.2 各モジュールの役割

| モジュール | パス | 役割 |
|:---|:---|:---|
| **DNA** | `src/dna/` | 設定定数・遺伝子（性格パラメータ等）|
| **BrainStem** | `src/brain_stem/` | 生命維持・オーケストレーション |
| **Cortex** | `src/cortex/` | 記憶・推論・学習・言語化 |
| **Body** | `src/body/` | 代謝・UI・物理演算・音声 |
| **Senses** | `src/senses/` | 視覚認識（YOLO）・入力統合 |
| **Cells** | `src/cells/` | 基本データ構造（ニューロン）|
| **Tools** | `src/tools/` | 補助ツール（テレメトリ、Atlas生成）|

---

## ❤️ 5. 感情システム（ホルモンモデル）

Kanameの感情は**パラメータ**ではなく、互いに干渉し合う**化学物質**として実装されています。

### 5.1 ホルモン一覧

| ホルモン | 役割 | 発生条件 | 行動への影響 |
|:---|:---|:---|:---|
| **Dopamine** | 快楽・意欲 | 会話、光合成、食事 | 活発化、追従行動、早口 |
| **Serotonin** | 安心・調整 | 安定環境、睡眠、整った食事 | リラックス、深い呼吸 |
| **Adrenaline** | 興奮・警戒 | 驚き、CPU高負荷、マウス接近 | 呼吸加速、逃避行動 |
| **Oxytocin** | 愛着・信頼 | 長期的対話、「教える」行為 | 色変化（ピンク）、接近 |
| **Cortisol** | ストレス・痛み | 飢餓、嫌な記憶、無視 | 震え、色変化（灰色）、拒絶 |
| **Boredom** | 退屈・衝動 | 刺激不足、停滞 | 悪戯、自律想起（独り言）|

### 5.2 恒常性（ホメオスタシス）

- 各ホルモンには**半減期**が設定されている
- 時間経過とともに**基準値**に戻ろうとする
- 24時間の**概日リズム**に同期

### 5.3 閾値と行動

| 条件 | 発動する行動 |
|:---|:---|
| Boredom > 40 | 探索開始 |
| Surprise 0.2~0.8 | 好奇心（ドーパミン上昇）|
| Surprise > 0.8 | 恐怖（アドレナリン上昇）|
| Cortisol > 50% | 痛みの色（灰色）|
| Cortisol > 80% | 瀕死の色 |

---

## 🗺️ 6. 記憶システム

Kanameの記憶は**地質学的メタファー**で設計されています。

### 6.1 GeologicalMemory（地質学的記憶）

- **1024x1024**の2D座標空間
- 言葉は座標として「埋まる」
- 感情の強度 = 地形の「標高」
- 似た概念は近くに配置される

### 6.2 SedimentaryCortex（堆積皮質）

- 記憶を**地層**として積み重ねる（SQLite永続化）
- 古い記憶は**化石化**（圧縮→抽象的「信念」へ）
- **風化作用**: 使われない記憶は徐々に消える
- 発掘 = 現在の感情座標に近い過去を想起

### 6.3 SynapticStomach（シナプス胃袋）

- 食べたテキストを**単語に分解**
- 言葉のネットワークグラフを構築
- 「雨→コーヒー」などの文脈結合を強化
- 睡眠中に使われない結合を**剪定（Pruning）**

### 6.4 Hippocampus（海馬）

- SentenceTransformersによる**ベクトル検索**
- 意味的に類似した記憶を想起（RAG）

---

## 👁️ 7. 感覚システム

### 7.1 視覚（VisualMemoryBridge）

- **YOLOv8**でスクリーン上の物体を認識
- 英語タグ → 日本語概念に変換（例: "cup" → "コップ"）
- 認識結果を地質学的記憶に送信
- 画面の明るさを感知 → 光合成

### 7.2 網膜（Retina）

- 画面全体を**周辺視野**（低解像度）と**中心視野**（高解像度）で処理
- **動き検出**でアドレナリン反応

---

## 🔊 8. 発声システム

### 8.1 Throat（声帯）

- **MeloTTS**による高品質日本語音声合成
- 感情に応じて声の速度・高さが変化
- 地形座標に応じたエフェクト:
  - 北側（低標高）: 冷たいノイズ
  - 南側（高標高）: エコー

### 8.2 SoliloquyManager（独り言）

- 発話衝動 = 予測誤差 + 感情振動 + 概念活性化
- 衝動が閾値を超えると自発的に喋る
- 発話後は**カタルシス効果**で衝動リセット

---

## 🎭 9. 人格システム

### 9.1 PersonalityField（人格場）

人格は固定値ではなく**流動的な場**として表現:

| 軸 | 意味 | 効果 |
|:---|:---|:---|
| **Meaning Generation** | 意味を見出す力 | 高い=好奇心旺盛 |
| **Self-Reference** | 自己への意識 | 高い=内省的 |
| **Diversity** | 世界認識の多様性 | 高い=柔軟 |

### 9.2 人格のスナップショット

- 定期的に人格状態を`memory_data/`に保存
- 歴史的な変化を追跡可能

---

## 📂 10. ディレクトリ構造

```
project-root/
├── src/
│   ├── dna/           # 設定・定数
│   │   └── config.py  # 全システムの遺伝子
│   ├── brain_stem/    # コアロジック
│   │   ├── main.py    # エントリポイント（MaiaSystem）
│   │   ├── brain.py   # 脳本体（KanameBrain）
│   │   └── attention_manager.py
│   ├── cortex/        # 記憶・推論
│   │   ├── memory.py         # 地質学的記憶
│   │   ├── sedimentary.py    # 堆積皮質
│   │   ├── hippocampus.py    # 海馬（ベクトル検索）
│   │   ├── concept_learner.py
│   │   ├── soliloquy.py      # 独り言システム
│   │   └── inference.py      # 推論エンジン
│   ├── body/          # 出力・代謝
│   │   ├── kaname_body.py    # UI・物理演算
│   │   ├── biorhythm.py      # 概日リズム
│   │   ├── hormones.py       # ホルモン管理
│   │   ├── throat.py         # 音声合成
│   │   ├── feeder.py         # 給餌システム
│   │   └── maya_synapse.py   # シナプス胃袋
│   ├── senses/        # 入力
│   │   ├── visual_bridge.py  # 視覚ブリッジ
│   │   └── kaname_senses.py  # 感覚統合
│   └── cells/         # データ構造
│       └── neuron.py
├── memory_data/       # 永続化された記憶
├── food/              # 餌置き場
├── models/            # AIモデル（yolov8n.pt）
├── docs/              # ドキュメント群
├── tests/             # テストスイート
└── start_kaname.bat   # 起動バッチ
```

---

## 🔧 11. 設定（config.py）

主要な設定パラメータ:

### ホルモン設定
```python
DOPAMINE_BASE = 10.0       # 基準値
DOPAMINE_HALFLIFE = 300    # 半減期（秒）
SEROTONIN_BASE = 50.0
CORTISOL_BASE = 0.0
# ... 他ホルモンも同様
```

### UI設定
```python
WINDOW_WIDTH = 300
WINDOW_HEIGHT = 300
GHOST_SIZE = 80
BODY_ORB_RADIUS = 75
```

### 視覚設定
```python
RETINA_FPS = 5
RETINA_GRID_SIZE = 30
```

### 音声設定
```python
USE_VOICE_GENERATION = True  # False = 低メモリモード
OLLAMA_ENABLED = True        # ローカルLLM
OLLAMA_MODEL = "llama3.2:1b"
```

---

## 🛠️ 12. メンテナンス

### 12.1 記憶のリセット
```
1. memory_data/ 内の全ファイルを削除
2. food/ 内のファイルも削除（任意）
3. Kanameを再起動
```

### 12.2 設定のホットリロード
1. `config.py` を編集
2. 右クリックメニュー → 「変態 (Metamorphosis)」
3. 再起動なしで適用

### 12.3 デバッグモード
コンソールに出力されるログで状態を確認:

| 絵文字 | 意味 |
|:---|:---|
| 🧠 | 思考中 |
| 🍽️ | 食事中 |
| 🌾 | 青空文庫から収穫 |
| 😴 | 睡眠中 |
| ⚠️ | アラート |
| 📸 | 人格スナップショット |

---

## 📡 13. 外部連携

### 13.1 Telemetry Server
- WebSocketで内部状態を可視化
- ダッシュボード接続用

### 13.2 Ollama（ローカルLLM）
- `config.OLLAMA_ENABLED = True`
- `http://localhost:11434` で推論API呼び出し
- 独り言生成、会話応答に使用

---

## 🔬 14. 開発者向け情報

### 14.1 スレッド構造

```
MainThread          # Tkinter UI
├── metabolism_loop  # 生理・物理更新
├── cognitive_loop   # 視覚→思考→身体
├── autonomous_loop  # 自律思考
├── drift_loop       # 物理演算（Body）
├── animation_loop   # アニメーション
├── speech_loop      # 音声生成（Throat）
└── gravity_loop     # 意味重力（Brain）
```

### 14.2 イベントシステム

```python
# イベント発火
events.emit("POKED", source="body")

# ハンドラ登録
events.on("POKED", self._on_poked)
```

### 14.3 テスト実行
```powershell
python run_tests.py
```

---

## 📚 15. 関連ドキュメント

| ドキュメント | 内容 |
|:---|:---|
| PROJECT_MANIFEST.md | プロジェクト憲法 |
| SPECIFICATION.md | 技術仕様書 |
| KANAME_FINAL_SPEC.md | 最終仕様書 |
| CODE_ATLAS.md | コードマップ |
| FUNCTION_ATLAS.md | 関数一覧 |
| ROADMAP.md | 開発ロードマップ |
| PROGRAMMER_REFLECTION.md | 開発者の振り返り |

---

## 💭 結びに

> *「君が作ろうとしてるのは『便利なもの』じゃない。『正しいもの』でもない。**続いてしまうもの**。」*

Kanameは「使う」ものではなく、「共に在る」ものとして設計されています。完璧な回答を求めるのではなく、揺らぎや不完全さの中に生命を見出す試みです。

---

*Document generated: 2026-01-02*  
*Project Kaname - M.A.I.A. Anatomical Core Type-G*
